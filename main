def caesar(txt, s):
    ntxt = ''
    for i in txt:
        if not (ord('А') <= ord(i) <= ord('Я') or ord('а') <= ord(i) <= ord('я')):
            ntxt += i
            continue
        if s < 0:
            if ord(i) + s < ord('А'):
                ntxt += chr(ord('Я') + (s + 1 + (ord(i) - ord('А'))))
            elif ord(i) + s < ord('а') <= ord(i):
                ntxt += chr(ord('я') + (s + 1 + (ord(i) - ord('а'))))
            else:
                ntxt += chr(ord(i) + s)
        else:
            if ord(i) + s > ord('я'):
                ntxt += chr(ord('а') + (s - 1 + (ord(i) - ord('я'))))
            elif ord(i) + s > ord('Я') >= ord(i):
                ntxt += chr(ord('А') + (s - 1 + (ord(i) - ord('Я'))))
            else:
                ntxt += chr(ord(i) + s)
    return ntxt


name = input(" Вы были рождены в семье дворян мантии (непотомственных) Бранте.\
 Ваш отец Роберт Бранте - известный и справедливый судья, а ваша мать Лидия - простолюдинка, как и вы.\
  \nКакого же имя данное вам вашими родителями?")
q = "(Вы всегда можете выйти написав 'конец')"
tag = 'старт'
while not tag.lower() == 'конец':
    if tag.lower() == 'старт':
        print(' Когда вам исполнилось шестнадцать лет, ваш отец отправил вас в столицу Империи, в надежде,\
         \nчто вы вступите в превстижную академию для детей дворян мантии. \
         \nНо поступление начнется только через неделю и пока что вы можете отдохнуть... Или нет. \
         \nКто-то постучал в вашу дверь. Откроете ли вы незнакомцу?', q)
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        elif ans.lower() == 'да':
            print("Вы спокойно открываете дверь.", end=" ")
        else:
            print("Хотите вы того или нет, запертая дверь открывается сама, как по волшебству.", end=" ")
        tag = "софия_1"
    elif tag.lower() == "софия_1":
        print(f" В вашу комнату входит София, ваша знакомая с детства. Лет пять назад, ее объявили ведьмой и она убежала, \
        \nс тех пор вы ее не видели. \n-Добрый вечер, {name}. Надеюсь я не побеспокоила тебя в 20 час.\
        \nЯ оставлю это тебе и пойду.\nОна положила листок на тумбочку около входа и ушла", q)
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'записка'
            init_text = " Нам не нужна Судьба, мы сделаем свою, мы создадим свою. \
            \nВозмем же мы свое, хотят того дворяне или нет! \nТе, что идут по мантии пути, станут в наши благородные ряды."
            init_text = caesar(init_text, -20)
            text = init_text
            print(f"В записке читалось '{text}' \n Это похоже на шифр. \
            \n\n[Если вы напишете число, то сдвинете шифр на соответстующее кол-во пунктов по алфавиту. \
            \nЕсли вы напишите 'сброс', то вернете изначальный шифр. \
            \nЕсли напишите что-то еще кроме 'конец', то выберете этот шифр, как правильный. \
            \nИгра не продолжится, пока вы не подберете шифр.]\n", q)
    elif tag.lower() == 'записка':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        elif ans.lower() == 'сброс':
            text = init_text
            print(text)
        elif ans.isdigit() or (ans[0] == '-' and ans[1:].isdigit()):
            text = caesar(text, int(ans))
            print(text)
        elif text == caesar(init_text, 20):
            print("\nНеужели? Они сделают что-то во время церемонии открытия?..")
            tag = 'дворянство_1'
        else:
            print("\nНичего непонятно. Попробуем снова.")
    elif tag.lower() == 'дворянство_1':
        print(" Церемония открытия академия для большинства, казалось бы ни что не предвещала. \
        \nВы конечено же знали, что что-то произойдет. Прозвучали выстрелы. \
        \nНет, это не были люди Софии. Это были предупредительные выстрелы гвардии брата Императора.\
        \n-Расходимся! Вы крестьяне не имеете права зваться дворянами. Эта школа закрывается.\
        \n Спокойствие перешло в панику. Паника перешла в недовольство. Недовольство перешло в ярость.\
        \nНикто не собирался сдавать свое права на дворянство. Толпа начала наступать.\
        \nТем временем, вы увидели в толпе с группой людей.\
        \nПоможете ли вы Софии (напишите 'София') или поведете толпу (напишите 'Я')?" + q)
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        elif ans.lower() == 'софия':
            tag = 'софия_2'
            print("Вы решили помочь Софии отбить атаку. Это будет означать, что вы разочаруете своего отца, не став\
            дворянином, но тогда ваша судьба будет только ваша. \
            \nГвардия не ожидала вашего нападения с фланга и отступила. Хотя школу и закрыли, никто не пострадал." + q)
        elif ans.lower() == 'я':
            tag = 'дворянство_2'
            print("Вы повели юных дворян вперед и отбили атаку Гвардии, по праву заняв свое место в академии." + q)
        else:
            print('Вы должны принять выбор!')
    elif tag.lower() == 'софия_2':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'софия_3'
            print("София поблагодарила вас за помощь и вы вступили в ее тайное общество." + q)
    elif tag.lower() == 'софия_3':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'софия_4'
            print("Вы помогаете вашему тайному обществу развиваться и покупаете печатный пресс для листовок." + q)
    elif tag.lower() == 'софия_4':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'софия_5'
            print("Ваше общество начинает стачку шахтеров после обвала шахты. Армия открывает огонь." + q)
    elif tag.lower() == 'софия_5':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'софия_конец'
            print("Убийство протестующих провоцирует полноценное восстание, которое перерастает в революцию." + q)
    elif tag.lower() == 'софия_конец':
        ans = input()
        print("Столица Империи занята. Правление сословий окончено. Но что будет дальше - совсем другая история." + q)
        tag = "конец"
    elif tag.lower() == 'дворянство_2':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'дворянство_3'
            print("Ваш отец рад вашему поступлению. Вы хорошо сдаете экзамен и становитесь судьей." + q)
    elif tag.lower() == 'дворянство_3':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'дворянство_4'
            print("Работая, как и ваш отец судьей, вас скоро назначают генералом Имперской Гвардии части Столицы." + q)
    elif tag.lower() == 'дворянство_4':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'дворянство_5'
            print("Шахтеры начали стачку после обвала шахты. Вы приказали выстрелить в них, что сделало все хуже" + q)
    elif tag.lower() == 'дворянство_5':
        ans = input()
        if ans.lower() == 'конец':
            tag = 'конец'
        else:
            tag = 'дворянство_конец'
            print("Началось настоящее восстание, революция. Ваша Гвардия сдерживает нападение до \
            прибытия подкреплений." + q)
    elif tag.lower() == 'дворянство_конец':
        ans = input()
        print("Восстание подавлено, хотя вам и придется подавить еще больше, это уже другая история.")
        tag = "конец"
